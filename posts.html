<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/svg+xml" href="/Favicons/browser.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Offline</title>
  <link rel="stylesheet" href="/src/Offline/offline.css" />

</head>
<body>
  <h1>You're Offline</h1>
  <h3>Here You can view some offline posts</h3>

  <div id="postsContainer"></div>

</body>
<script>
  function getPostsFromIndexedDB() {
    const request = indexedDB.open('postsDB', 3);
  
    request.onsuccess = function(event) {
      const db = event.target.result;
      const transaction = db.transaction(['posts'], 'readonly');
      const objectStore = transaction.objectStore('posts');
      const getAllRequest = objectStore.getAll();
  
      getAllRequest.onsuccess = function() {
        // Check if there are any posts in IndexedDB
        if (getAllRequest.result.length > 0) {
          displayPosts(getAllRequest.result);
        } else {
          console.log('No posts in IndexedDB');
        }
      };
  
      getAllRequest.onerror = function() {
        console.log('Error getting posts from IndexedDB');
      };
    };
  
    request.onerror = function(event) {
      console.log('Database error:', event.target.error);
    };
  }
  
  // Function to display posts
  function displayPosts(posts) {
    const postsContainer = document.getElementById('postsContainer');
    postsContainer.innerHTML = ''; // Clear the container
  
    posts.forEach(post => {
      const postElement = document.createElement('div');
      const imageBase64 = post.image.replace('data:text/html;base64,', 'data:image/png;base64');
      console.log(imageBase64);
      postElement.innerHTML = `
        <h2>${post.user.username}</h2>
        <p>${post.text_content}</p>
        
        <img src="${imageBase64}" alt="Post image">
      `;

      postsContainer.appendChild(postElement);
    });
  }
  
  getPostsFromIndexedDB();
</script>
</html>
